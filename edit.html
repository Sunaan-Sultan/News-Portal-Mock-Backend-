<!DOCTYPE html>
<html>
<body onload="loadNews()">

<h2>Edit News</h2>
<input id="title"><br><br>
<textarea id="body"></textarea><br><br>
<button onclick="update()">Update</button>

<script src="utils.js"></script>
<script>
requireLogin();

const id = new URLSearchParams(location.search).get("id");
let news;

async function loadNews() {
  news = await fetch(`${API}/news/${id}`).then(r => r.json());

  if (news.author_id !== getUser().id) {
    alert("You are not allowed to edit this");
    location.href = "news.html";
  }

  title.value = news.title;
  body.value = news.body;
}

function update() {
  fetch(`${API}/news/${id}`, {
    method: "PATCH",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      title: title.value,
      body: body.value
    })
  }).then(() => location.href = "news.html");
}
</script>
</body>
</html>
